# –û—Ç–ª–∞–¥–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞—Å—á–µ—Ç–æ–≤

## –ß—Ç–æ —è –¥–æ–±–∞–≤–∏–ª

–î–æ–±–∞–≤–∏–ª –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ –º–µ—Å—Ç–∞:

### 1. Middleware –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (`auth.js`)
- üîì –í—Ö–æ–¥ –≤ optionalAuth
- üé´ –û–±–Ω–∞—Ä—É–∂–µ–Ω —Ç–æ–∫–µ–Ω
- ‚úÖ –¢–æ–∫–µ–Ω –ø—Ä–æ–≤–µ—Ä–µ–Ω, userId
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω

### 2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–æ–≤ (`calculationController.js` - createCalculation)
- üìä –ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞
- User: ID –∏–ª–∏ Guest
- üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–ª—è user_id
- ‚úÖ –†–∞—Å—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ (`calculationController.js` - getCalculations)
- üìã –ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–æ–≤
- User: ID –∏–ª–∏ Guest
- üîç –ó–∞–ø—Ä–æ—Å –∫ –ë–î –¥–ª—è user_id
- ‚úÖ –ù–∞–π–¥–µ–Ω–æ N —Ä–∞—Å—á–µ—Ç–æ–≤

## –ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### –®–∞–≥ 1: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω

–û—Ç–∫—Ä–æ–π—Ç–µ `server/.env` –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤–∞—à IP —É–∫–∞–∑–∞–Ω:

```env
CORS_ORIGIN=http://localhost:8081,exp://172.20.10.2:8081
```

–î–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å IP –≤ `utils/api.ts`!

### –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ (Ctrl+C)
cd server
npm run dev
```

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏

#### 3.1 –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–≤—Ö–æ–¥–∞

–°–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å:
```
POST /api/auth/login
‚úÖ Login successful for: –≤–∞—à@email.com
```

#### 3.2 –°–¥–µ–ª–∞–π—Ç–µ —Ä–∞—Å—á–µ—Ç

–°–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å:
```
POST /api/calculations
üîì optionalAuth middleware
üé´ Token found, length: XXX
‚úÖ Token verified, userId: 1
‚úÖ User authenticated: –≤–∞—à@email.com
üìä Create calculation request
User: ID 1
üíæ Saving calculation for user_id: 1
Executed query { text: 'INSERT INTO calculations...', duration: XX, rows: 1 }
‚úÖ Calculation saved: 1
```

#### 3.3 –û—Ç–∫—Ä–æ–π—Ç–µ –∏—Å—Ç–æ—Ä–∏—é (–≤–∫–ª–∞–¥–∫–∞ Explore)

–°–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å:
```
GET /api/calculations
üîì optionalAuth middleware
üé´ Token found, length: XXX
‚úÖ Token verified, userId: 1
‚úÖ User authenticated: –≤–∞—à@email.com
üìã Get calculations request
User: ID 1
üîç Fetching calculations for user_id: 1
Executed query { text: 'SELECT * FROM calculations...', duration: XX, rows: N }
‚úÖ Found N calculations
```

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "No auth header - guest mode" –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∏—Å—Ç–æ—Ä–∏–∏

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–æ–∫–µ–Ω –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –∑–∞–ø—Ä–æ—Å–æ–º

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ —Ç–æ–∫–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–π—Ç–∏ –∏ –≤–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "Token verification failed"

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –∏–ª–∏ –∏—Å—Ç–µ–∫

**–†–µ—à–µ–Ω–∏–µ:**
1. –í—ã–π–¥–∏—Ç–µ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –í–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
3. –°—Ä–∞–∑—É —Å–¥–µ–ª–∞–π—Ç–µ —Ä–∞—Å—á–µ—Ç –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å—Ç–æ—Ä–∏—é

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –†–∞—Å—á–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è, –Ω–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º–∞ —Å —Ñ–æ—Ä–º–∞—Ç–æ–º –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
- –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ "‚úÖ Found N calculations" –≥–¥–µ N > 0
- –ó–Ω–∞—á–∏—Ç –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å –≤ –ë–î
- –ü—Ä–æ–±–ª–µ–º–∞ –≤ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏ –∏–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ë–î –≤—Ä—É—á–Ω—É—é:**
```sql
psql -U postgres -d calculator_db
SELECT id, user_id, total_calories, created_at FROM calculations ORDER BY created_at DESC;
```

### –ü—Ä–æ–±–ª–µ–º–∞ 4: CORS –æ—à–∏–±–∫–∞

**–õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ–∫–∞–∂—É—Ç:**
```
OPTIONS /api/calculations
POST /api/calculations
```

–ù–æ –æ—Ç–≤–µ—Ç –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ:**
–û–±–Ω–æ–≤–∏—Ç–µ `server/.env`:
```env
CORS_ORIGIN=http://localhost:8081,exp://172.20.10.2:8081
```
–ì–¥–µ `172.20.10.2` - –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π IP –∏–∑ `utils/api.ts`

## –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è**
   - –û—Ç–∫—Ä–æ–π—Ç–µ –ü—Ä–æ—Ñ–∏–ª—å ‚Üí –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
   - Email: test2@test.com
   - Password: test123
   - –ò–º—è: Test User
   - –ù–∞–∂–º–∏—Ç–µ "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è"

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞**
   ```
   POST /api/auth/register
   üìù Registration attempt: { email: 'test2@test.com', name: 'Test User' }
   üîê Password hashed
   ‚úÖ User created: { id: 2, email: 'test2@test.com' }
   üé´ Token generated
   ‚úÖ Registration successful for: test2@test.com
   ```

3. **–°–¥–µ–ª–∞–π—Ç–µ —Ä–∞—Å—á–µ—Ç**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω (Calculator)
   - –í–≤–µ–¥–∏—Ç–µ –ª—é–±—ã–µ –¥–∞–Ω–Ω—ã–µ
   - –ù–∞–∂–º–∏—Ç–µ "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å"

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞**
   ```
   POST /api/calculations
   üîì optionalAuth middleware
   üé´ Token found, length: XXX
   ‚úÖ Token verified, userId: 2
   ‚úÖ User authenticated: test2@test.com
   üìä Create calculation request
   User: ID 2
   üíæ Saving calculation for user_id: 2
   ‚úÖ Calculation saved: 1
   ```

5. **–û—Ç–∫—Ä–æ–π—Ç–µ –∏—Å—Ç–æ—Ä–∏—é**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É Explore (–ò—Å—Ç–æ—Ä–∏—è)
   - –ü–æ—Ç—è–Ω–∏—Ç–µ –≤–Ω–∏–∑ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (pull to refresh)

6. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞**
   ```
   GET /api/calculations
   üîì optionalAuth middleware
   üé´ Token found, length: XXX
   ‚úÖ Token verified, userId: 2
   ‚úÖ User authenticated: test2@test.com
   üìã Get calculations request
   User: ID 2
   üîç Fetching calculations for user_id: 2
   ‚úÖ Found 1 calculations
   ```

7. **–ï—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞—è**
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –í–°–ï –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
   - –ü–æ–∫–∞–∂–∏—Ç–µ –º–Ω–µ - —è —É–≤–∏–∂—É –≥–¥–µ –ø—Ä–æ–±–ª–µ–º–∞

## –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ë–î

```sql
-- –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
psql -U postgres -d calculator_db

-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
SELECT id, email, name FROM users;

-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Ä–∞—Å—á–µ—Ç—ã
SELECT id, user_id, total_calories, created_at 
FROM calculations 
ORDER BY created_at DESC;

-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞—Å—á–µ—Ç—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∑–∞–º–µ–Ω–∏—Ç–µ 1 –Ω–∞ —Å–≤–æ–π ID)
SELECT * FROM calculations WHERE user_id = 1;
```

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

1. ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä —Å –Ω–æ–≤—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
2. ‚úÖ –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ CORS_ORIGIN –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. ‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å/–≤–æ–π–¥–∏—Ç–µ
4. ‚úÖ –°–¥–µ–ª–∞–π—Ç–µ —Ä–∞—Å—á–µ—Ç
5. ‚úÖ –û—Ç–∫—Ä–æ–π—Ç–µ –∏—Å—Ç–æ—Ä–∏—é
6. üìã –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –ø–æ–∫–∞–∂–∏—Ç–µ –º–Ω–µ

**–õ–æ–≥–∏ –ø–æ–∫–∞–∂—É—Ç —Ç–æ—á–Ω–æ –≥–¥–µ –ø—Ä–æ–±–ª–µ–º–∞!**
